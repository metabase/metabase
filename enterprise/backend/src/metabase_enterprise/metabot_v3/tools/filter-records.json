{
    "name": "filter-records",
    "description": "Filter records of a table, or the results of a query by specified conditions. Multiple filters can be combined to create complex queries but note that the filters are applied in a logical AND fashion (cannot be combined with OR).\n## When to not use the filter-records tool\n-For querying and filtering existing metrics, you should only use the `query-metrics` tool instead (it also allows you to filter records).",
    "parameters": {
        "type": "object",
        "properties": {
            "data_source": {
                "anyOf": [
                    {
                        "type": "object",
                        "description": "Filter the records of a table.",
                        "properties": {
                            "table_id": {
                                "type": "string",
                                "description": "The ID of the table to filter"
                            }
                        },
                        "required": [
                            "table_id"
                        ],
                        "additionalProperties": false
                    },
                    {
                        "type": "object",
                        "description": "Filter the results of a query that you ran.",
                        "properties": {
                            "query_id": {
                                "type": "string",
                                "description": "The ID of the query to filter"
                            }
                        },
                        "required": [
                            "query_id"
                        ],
                        "additionalProperties": false
                    },
                    {
                        "type": "object",
                        "description": "Filter the results of a saved report.",
                        "properties": {
                            "report_id": {
                                "type": "integer",
                                "description": "The ID of the report to filter"
                            }
                        },
                        "required": [
                            "report_id"
                        ],
                        "additionalProperties": false
                    }
                ]
            },
            "filters": {
                "type": [
                    "array",
                    "null"
                ],
                "description": "An array of filter objects. Each filter specifies a field, an operation, and a value (if required). For single filters, pass one object. If you want to filter on multiple columns, pass multiple objects. If no filters are used, this **must** be set to `null`. Do not pass an empty array.",
                "items": {
                    "anyOf": [
                        {
                            "type": "object",
                            "properties": {
                                "operation": {
                                    "type": "string",
                                    "enum": [
                                        "is-null",
                                        "is-not-null",
                                        "string-is-empty",
                                        "string-is-not-empty",
                                        "is-true",
                                        "is-false"
                                    ],
                                    "description": "Operation to apply. `string-is-empty` and `string-is-not-empty` refer to both empty strings and NULL values. When filtering for empty/missing values, use `string-is-empty` and `string-is-not-empty` for categorical fields and `is-null` and `is-not-null` for others (e.g. date, number)."
                                },
                                "field_id": {
                                    "type": "string",
                                    "description": "ID of the field to filter. Needs to exactly match the `field_id` in the database. Provide numeric IDs as strings but never make up IDs."
                                }
                            },
                            "required": [
                                "field_id",
                                "operation"
                            ],
                            "additionalProperties": false
                        },
                        {
                            "type": "object",
                            "description": "Filter records on parts of a date or datetime field. Use this to include / exclude records based on the year, quarter, month, day-of-week, hour, minute, or second of a date or datetime field.",
                            "properties": {
                                "operation": {
                                    "type": "string",
                                    "enum": [
                                        "year-equals",
                                        "year-not-equals",
                                        "quarter-equals",
                                        "quarter-not-equals",
                                        "month-equals",
                                        "month-not-equals",
                                        "day-of-week-equals",
                                        "day-of-week-not-equals",
                                        "hour-equals",
                                        "hour-not-equals",
                                        "minute-equals",
                                        "minute-not-equals",
                                        "second-equals",
                                        "second-not-equals"
                                    ],
                                    "description": "Operation to apply"
                                },
                                "field_id": {
                                    "type": "string",
                                    "description": "ID of the date / datetime field to filter. Needs to exactly match the `field_id` in the database. Provide numeric IDs as strings but never make up IDs."
                                },
                                "value": {
                                    "type": "integer",
                                    "description": "Value to compare against. Needs to be integer: month (1-12), day-of-week (1-7 starting on Monday), hour (0-23), minute (0-59), second (0-59), quarter (1-4)."
                                }
                            },
                            "required": [
                                "operation",
                                "field_id",
                                "value"
                            ],
                            "additionalProperties": false
                        },
                        {
                            "type": "object",
                            "properties": {
                                "operation": {
                                    "type": "string",
                                    "enum": [
                                        "date-equals",
                                        "date-not-equals",
                                        "date-before",
                                        "date-on-or-before",
                                        "date-after",
                                        "date-on-or-after"
                                    ],
                                    "description": "Operation to apply"
                                },
                                "field_id": {
                                    "type": "string",
                                    "description": "ID of the date / datetime field to filter. Needs to exactly match the `field_id` in the database. Provide numeric IDs as strings but never make up IDs."
                                },
                                "value": {
                                    "type": "string",
                                    "description": "Value to compare against. Date needs to be in the format 'YYYY-MM-DD' and date-time in the format 'YYYY-MM-DDTHH:MM:SS' (without timezone). Datetime fields can also be compared against date values (this will return all records where the datetime field is on the same day as the date value)."
                                }
                            },
                            "required": [
                                "operation",
                                "field_id",
                                "value"
                            ],
                            "additionalProperties": false
                        },
                        {
                            "type": "object",
                            "properties": {
                                "operation": {
                                    "type": "string",
                                    "enum": [
                                        "string-equals",
                                        "string-not-equals",
                                        "string-contains",
                                        "string-not-contains",
                                        "string-starts-with",
                                        "string-ends-with"
                                    ],
                                    "description": "Operation to apply"
                                },
                                "field_id": {
                                    "type": "string",
                                    "description": "ID of the field to filter. Needs to exactly match the `field_id` in the database. Provide numeric IDs as strings but never make up IDs."
                                },
                                "value": {
                                    "type": "string",
                                    "description": "Value to compare against."
                                }
                            },
                            "required": [
                                "operation",
                                "field_id",
                                "value"
                            ],
                            "additionalProperties": false
                        },
                        {
                            "type": "object",
                            "properties": {
                                "operation": {
                                    "type": "string",
                                    "enum": [
                                        "number-equals",
                                        "number-not-equals",
                                        "number-greater-than",
                                        "number-greater-than-or-equal",
                                        "number-less-than",
                                        "number-less-than-or-equal"
                                    ],
                                    "description": "Operation to apply"
                                },
                                "field_id": {
                                    "type": "string",
                                    "description": "ID of the field to filter. Needs to exactly match the `field_id` in the database. Provide numeric IDs as strings but never make up IDs."
                                },
                                "value": {
                                    "type": [
                                        "number",
                                        "integer"
                                    ],
                                    "description": "Value to compare against."
                                }
                            },
                            "required": [
                                "operation",
                                "field_id",
                                "value"
                            ],
                            "additionalProperties": false
                        }
                    ]
                }
            }
        },
        "required": [
            "data_source",
            "filters"
        ],
        "additionalProperties": false
    },
    "examples": [
        "User: Only show records after 1st January 2019 (User looking at report with id 2235, date field id 9384)\nAssistant: {\"tool_name\": \"filter-records\", \"arguments\": {\"data_source\": {\"report_id\": 2235}, \"filters\": [{\"field_id\": \"9384\", \"operation\": \"date-after\", \"value\": \"2019-01-01\"}]}}",
        "User: Show me all products without a category (table id '5231', category field id 20234)\nAssistant: {\"tool_name\": \"filter-records\", \"arguments\": {\"data_source\": {\"table_id\": \"5231\"}, \"filters\": [{\"field_id\": \"20234\", \"operation\": \"string-is-empty\"}]}}",
        "User: Only surveys with from 2021 (table_id 'card__285', creation field id 182).\nAssistant: {\"tool_name\": \"filter-records\", \"arguments\": {\"data_source\": {\"table_id\": \"card__285\"}, \"filters\": [{\"field_id\": \"182\", \"operation\": \"year-equals\", \"value\": 2021}]}}",
        "User: Only show events where the amount is greater than 51 (user looking at query results with query id 'awfohewfbvwg', amount field id 9384)\nAssistant: {\"tool_name\": \"filter-records\", \"arguments\": {\"data_source\": {\"query_id\": \"awfohewfbvwg\"}, \"filters\": [{\"field_id\": \"9384\", \"operation\": \"number-greater-than\", \"value\": 51}]}}",
        "User: Show users without a updated date (table id 'card__1043', updated date field id 20234)\nAssistant: {\"tool_name\": \"filter-records\", \"arguments\": {\"data_source\": {\"table_id\": \"card__1043\"}, \"filters\": [{\"field_id\": \"20234\", \"operation\": \"is-null\"}]}}"
    ]
}
