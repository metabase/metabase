(ns metabase-enterprise.metabot-v3.agent.profiles
  "Profile configurations for different metabot use cases.
  Each profile defines model settings, iteration limits, and available tools.")

(def profiles
  "Map of profile-id to profile configuration.

  Each profile includes:
  - :prompt-template - Selmer template name from resources/metabot/prompts/system/
  - :model - LLM model identifier
  - :max-iterations - Maximum agent loop iterations
  - :temperature - LLM temperature setting
  - :tools - Vector of tool names available to this profile"
  {:embedding
   {:prompt-template "embedding.selmer"
    :model "claude-sonnet-4-5-20250929"
    :max-iterations 6
    :temperature 0.3
    :tools ["search"
            "query_metric"
            "query_model"
            "get_field_values"
            "show_results_to_user"
            "read_resource"]}

   :internal
   {:prompt-template "internal.selmer"
    :model "claude-sonnet-4-5-20250929"
    :max-iterations 10
    :temperature 0.3
    :tools ["search"
            "query_metric"
            "query_model"
            "get_field_values"
            "get_entity_details"
            "get_metric_details"
            "get_field_stats"
            "show_results_to_user"
            "find_outliers"
            "generate_insights"
            "create_dashboard_subscription"
            "invite_user"
            "create_sql_query"
            "edit_sql_query"
            "replace_sql_query"
            "sql_search"
            "read_resource"
            "create_chart"
            "edit_chart"
            "navigate_user"
            "create_autogenerated_dashboard"]}

   :transforms-codegen
   {:prompt-template "transform-codegen.selmer"
    :model "claude-sonnet-4-5-20250929"
    :max-iterations 30
    :temperature 0.3
    :tools ["search"
            "get_transform_details"
            "get_entity_details"
            "get_field_stats"
            "get_field_values"
            "read_resource"
            "todo_write"
            "todo_read"
            "write_transform_sql"
            "write_transform_python"
            "list_snippets"
            "get_snippet_details"]}

   :sql-only
   {:prompt-template "sql-querying-only.selmer"
    :model "claude-sonnet-4-5-20250929"
    :max-iterations 8
    :temperature 0.3
    :required-tool-call? true
    :tools ["search"
            "get_entity_details"
            "get_field_stats"
            "create_sql_query"
            "edit_sql_query"
            "replace_sql_query"
            "sql_search"
            "read_resource"
            "ask_for_sql_clarification"]}

   ;; New profiles for additional use cases

   :next
   {:prompt-template "metabot-next.selmer"
    :model "claude-sonnet-4-5-20250929"
    :max-iterations 10
    :temperature 0.3
    :tools ["search"
            "query_metric"
            "query_model"
            "get_field_values"
            "get_entity_details"
            "get_metric_details"
            "get_field_stats"
            "show_results_to_user"
            "find_outliers"
            "generate_insights"
            "create_dashboard_subscription"
            "invite_user"
            "create_sql_query"
            "edit_sql_query"
            "replace_sql_query"
            "sql_search"
            "read_resource"
            "create_chart"
            "edit_chart"
            "navigate_user"
            "create_autogenerated_dashboard"]}

   :nlq-only
   {:prompt-template "natural-language-querying-only.selmer"
    :model "claude-sonnet-4-5-20250929"
    :max-iterations 8
    :temperature 0.3
    :tools ["search"
            "query_metric"
            "query_model"
            "get_field_values"
            "show_results_to_user"
            "read_resource"
            "navigate_user"
            "create_chart"
            "edit_chart"]}

   :beta-customer
   {:prompt-template "internal.selmer"
    :model "claude-sonnet-4-5-20250929"
    :max-iterations 8
    :temperature 0.3
    :tools ["search"
            "query_metric"
            "query_model"
            "get_field_values"
            "get_entity_details"
            "get_metric_details"
            "get_field_stats"
            "show_results_to_user"
            "create_sql_query"
            "edit_sql_query"
            "replace_sql_query"
            "sql_search"
            "read_resource"
            "navigate_user"
            "create_chart"
            "edit_chart"]}})

(defn get-profile
  "Get profile configuration by profile-id keyword."
  [profile-id]
  (get profiles profile-id))
