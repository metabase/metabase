type: v0/model
ref: customer-summary
name: Customer Summary Model
description: Consolidated view of customer data with key business metrics and attributes
database: sample_database

# SQL query that defines the model's data
# Note: In this example, we're simulating various data type scenarios for demonstration
query: |
  SELECT 
    c.id AS customer_id,
    c.name AS customer_name,
    c.email,
    c.company,
    c.city,
    c.state,
    c.country,
    c.zip_code,
    c.latitude,
    c.longitude,
    c.created_at AS signup_date,
    EXTRACT(EPOCH FROM c.created_at)::INTEGER AS signup_timestamp_unix,  -- Unix timestamp example
    c.birth_date::TEXT AS birth_date_str,  -- Date as string example
    COUNT(DISTINCT o.id) AS order_count,
    SUM(o.total) AS lifetime_value,
    AVG(o.tax_rate) AS avg_tax_rate,
    MAX(o.created_at) AS last_order_date,
    c.status_code,  -- Numeric code that should be a category
    c.is_verified,
    CASE 
      WHEN SUM(o.total) > 1000 THEN 'VIP'
      WHEN SUM(o.total) > 500 THEN 'Regular'
      WHEN SUM(o.total) > 0 THEN 'Occasional'
      ELSE 'New'
    END AS customer_segment,
    c.preferences_json::TEXT AS preferences  -- JSON stored as text
  FROM customers c
  LEFT JOIN orders o ON c.id = o.customer_id
  GROUP BY c.id, c.name, c.email, c.company, c.city, c.state, c.country, 
           c.zip_code, c.latitude, c.longitude, c.created_at, c.birth_date,
           c.status_code, c.is_verified, c.preferences_json

# Column metadata for better usability
# Note: Models CANNOT use coercion_strategy - that's only for database fields
columns:
  - name: customer_id
    display_name: Customer ID
    description: Unique identifier for each customer
    base_type: Big Integer  # What the query returns
    semantic_type: Entity Key  # Marks this as a primary key
    
  - name: customer_name
    display_name: Full Name
    description: Customer's full name
    base_type: Text
    semantic_type: Entity Name
    
  - name: email
    display_name: Email Address
    description: Primary contact email for the customer
    base_type: Text
    effective_type: Email  # Text recognized as email (no coercion needed for models)
    semantic_type: Email
    visibility: sensitive  # Mark as PII
    
  - name: company
    display_name: Company
    description: Customer's associated company or organization
    base_type: Text
    semantic_type: Company
    
  - name: city
    display_name: City
    description: Customer's city location
    base_type: Text
    effective_type: City  # Enhances filtering capabilities
    semantic_type: City
    
  - name: state
    display_name: State/Province
    description: Customer's state or province
    base_type: Text
    effective_type: State
    semantic_type: State
    
  - name: country
    display_name: Country
    description: Customer's country
    base_type: Text
    effective_type: Country
    semantic_type: Country
    
  - name: zip_code
    display_name: ZIP Code
    description: Customer's postal code
    base_type: Text
    semantic_type: Zip Code
    
  - name: latitude
    display_name: Latitude
    description: Geographic latitude coordinate
    base_type: Float
    semantic_type: Latitude
    
  - name: longitude
    display_name: Longitude
    description: Geographic longitude coordinate
    base_type: Float
    semantic_type: Longitude
    
  - name: signup_date
    display_name: Registration Date
    description: Date when the customer first signed up
    base_type: DateTime
    semantic_type: Creation timestamp
    
  - name: signup_timestamp_unix
    display_name: Registration Timestamp (Unix)
    description: Unix timestamp of customer signup (example of integer as datetime)
    base_type: Integer  # Query returns integer
    effective_type: Instant  # Treat as datetime (Models set this directly, no coercion)
    
  - name: birth_date_str
    display_name: Birth Date
    description: Customer's birth date (stored as string in this example)
    base_type: Text  # Query returns text
    effective_type: Date  # Treat as date (Models don't use coercion)
    
  - name: order_count
    display_name: Total Orders
    description: Number of orders placed by this customer
    base_type: Integer
    semantic_type: Quantity
    
  - name: lifetime_value
    display_name: Customer LTV
    description: Total revenue generated from this customer
    base_type: Decimal
    semantic_type: Currency
    currency: USD  # Additional metadata for currency formatting
    
  - name: avg_tax_rate
    display_name: Average Tax Rate
    description: Average tax rate across all customer orders
    base_type: Decimal
    semantic_type: Percentage
    
  - name: last_order_date
    display_name: Last Purchase Date
    description: Date of the customer's most recent order
    base_type: DateTime
    semantic_type: Updated timestamp
    
  - name: status_code
    display_name: Status
    description: Customer status (1=Active, 2=Inactive, 3=Suspended)
    base_type: Integer  # Numeric in database
    effective_type: Category  # Treat as category for better filtering
    
  - name: is_verified
    display_name: Verified Account
    description: Whether the customer's account has been verified
    base_type: Boolean
    
  - name: customer_segment
    display_name: Customer Segment
    description: Customer categorization based on lifetime value (VIP, Regular, Occasional, New)
    base_type: Text
    effective_type: Category  # Computed category field
    semantic_type: Category
    
  - name: preferences
    display_name: User Preferences
    description: Customer preferences stored as JSON
    base_type: Text  # Query returns text
    effective_type: Structured  # Indicates JSON/structured data
    visibility: sensitive  # May contain PII