default: &default
  - "locales/**"
  - "bin/**/!(*.md)"

shared_sources: &shared_sources
  - "src/**/*.cljc"
  - "src/**/*.cljs"
  - "package.json"

shared_specs: &shared_specs
  - "test/**/*.cljc"
  - "test/**/*.cljs"

shared_ci: &shared_ci
  - ".github/actions/prepare-frontend/**"
  - ".github/actions/prepare-backend/**"
  - ".github/workflows/run-tests.yml"

shared_e2e: &shared_e2e
  - "e2e/runner/**"
  - "e2e/snapshot-creators/**"
  - "e2e/support/**"

frontend_ci: &frontend_ci
  - *shared_ci
  - ".github/workflows/frontend.yml"

frontend_configs: &frontend_configs
  - "yarn.lock"
  - "**/tsconfig*.json"
  - "package.json"
  - "babel.config.json"
  - ".eslintrc.js"
  - "postcss.config.js"
  - "rspack.config.js"
  - "rspack.main.config.js"
  - "rspack.embedding-sdk-package.config.js"
  - "rspack.embedding-sdk-bundle.config.js"
  - "rspack.static-viz.config.js"
  - ".nvmrc"

frontend_sources: &frontend_sources
  - *shared_sources
  - *frontend_configs
  - "enterprise/frontend/!(test)**/**/{!(*.spec),}.{js,jsx,ts,tsx,css}"
  - "frontend/!(test)**/**/{!(*.spec),}.{js,jsx,ts,tsx,css}"

# Used only in .github/workflows/conventional-commit-pr-title-reminder.yml
frontend_embedding_sources:
  - "enterprise/frontend/src/{embedding,embedding-*}/**/{!(*.spec),}.{js,jsx,ts,tsx,css}"
  - "enterprise/frontend/src/metabase-enterprise/{embedding,embedding-*}**/{!(*.spec),}.{js,jsx,ts,tsx,css}"

# Used only in .github/workflows/embedding-sdk-labels-reminder.yml
frontend_embedding_sdk_package_sources:
  - "enterprise/frontend/src/embedding-sdk-package/**/!(*.spec).{js,jsx,ts,tsx,css}"

frontend_specs: &frontend_specs
  - *shared_specs
  - "frontend/test/**"
  - "frontend/**/tests/**"
  - "frontend/**/*.unit.*"
  - "enterprise/frontend/**/*.unit.*"
  - ".github/**/*.unit.spec.*"
  - "jest.config.js"
  - "jest.tz.unit.conf.json"

release_source: &release_sources
  - "release/**"

frontend_all: &frontend_all
  - *frontend_ci
  - *frontend_sources
  - *frontend_specs

frontend_loki_ci: &frontend_loki_ci
  - ".github/workflows/loki.yml"
  - ".loki/**"
  - ".storybook/**"

backend_ci: &backend_ci
  - *shared_ci
  - ".github/actions/test-driver/**"
  - ".github/workflows/backend.yml"
  - ".github/workflows/drivers.yml"

backend_presto_kerberos:
  - "**/presto_jdbc/**"
  - "**/presto-jdbc/**" # the driver module has a hyphen. underscores are classpaths
  - "**/presto_jdbc.clj"
  - "**/presto_jdbc_test.clj"
  - ".github/workflows/presto-kerberos-integration-test.yml"

backend_sources: &backend_sources
  - *shared_sources
  - "**deps.edn"
  - "enterprise/backend/src/**"
  - "src/**"
  - "modules/drivers/{*,*/{*,!(test)/**}}"
  - "resources/**"
  - ".clj-kondo/**"

backend_specs: &backend_specs
  - *shared_specs
  - "test/**"
  - "enterprise/backend/test/**"
  - "test_modules/**"
  - "modules/drivers/*/test/**"
  - "test_config/**"
  - "test_resources/**"

backend_all: &backend_all
  - *default
  - *backend_ci
  - *backend_sources
  - *backend_specs

sources: &sources
  - *shared_sources
  - *frontend_sources
  - *backend_sources

e2e_ci: &e2e_ci
  - *shared_ci
  - ".github/actions/prepare-uberjar-artifact/**"
  - ".github/actions/fetch-artifact/action.yml"
  - ".github/actions/e2e-prepare-containers/**"
  - ".github/actions/prepare-cypress/**"
  - ".github/workflows/e2e-*"

e2e_specs: &e2e_specs
  - e2e/!(test-host-app)**/*.cy.*.{js,ts}

embedding_sdk_ci: &embedding_sdk_ci
  - *shared_ci
  - ".github/actions/prepare-uberjar-artifact/**"
  - ".github/actions/fetch-artifact/action.yml"
  - ".github/actions/prepare-cypress/**"
  - ".github/workflows/embedding-sdk*.yml"

embedding_sdk_components:
  - *default
  - *embedding_sdk_ci
  - *sources
  - *shared_e2e
  - "e2e/test-component/**/*.cy.*.{js,jsx,ts,tsx}"

embedding_sdk_host_sample_apps:
  - *default
  - *embedding_sdk_ci
  - *frontend_sources
  - *backend_sources
  - *shared_e2e
  - "e2e/embedding-sdk-host-apps/**"
  - "e2e/test-host-app/**/*.cy.*.{js,ts}"

snowplow: &snowplow
  - ".github/workflows/snowplow.yml"
  - "snowplow/**"

e2e_all:
  - *default
  - *e2e_ci
  - *sources
  - *e2e_specs
  - "e2e/**"
  - *snowplow

documentation:
  - "docs/**"
  - "**/*.md"

embedding_documentation:
  - ".typedoc/**"
  - "docs/embedding/**"

yaml:
  - "**/*.yml"
  - "**/*.yaml"

codeql:
  - ".github/workflows/codeql.yml"
  - "frontend/src/**"
  - "enterprise/frontend/src/**"

i18n:
  - *default
  - ".github/actions/prepare-frontend/**"
  - ".github/actions/prepare-backend/**"
  - ".github/workflows/i18n.yml"
  - *sources

visualizations:
  - "frontend/src/metabase/visualizations/**"
  - "frontend/src/metabase/static-viz/**"
  - "src/metabase/pulse/**"

cljs:
  - *shared_sources
  - *shared_specs
  - ".github/workflows/cljs.yml"
  - "shadow-cljs.edn"

openapi:
  - ".github/workflows/openapi.yml"
  - "src/metabase/api/**"
  - "src/metabase/api_routes/**"
  - "src/metabase/*_rest/api.clj"
  - "src/metabase/*/api.clj"
  - "src/metabase/*/api/*.clj"
  - "enterprise/backend/src/metabase_enterprise/**/api.clj"
  - "enterprise/backend/src/metabase_enterprise/**/api/*.clj"
  - "resources/openapi/**"
  - "package.json"
