<section class="wrapper">
    <form novalidate>
        <div class="py2 border-bottom">
            <h2>Email Report</h2>

            <div class="py1 float-right">
              <div>
                <label class="block">Mode:</label>
                <div class="Button-group">
                  <a class="Button" ng-repeat="mode in form_input.modes" ng-class="{ 'Button--selected' : report.mode == mode.id }" ng-model="report.mode" btn-radio="mode.id">{{mode.name}}</a>
                </div>
              </div>

              <div class="py2">
                <label class="block">Permissions:</label>
                <div class="Select block">
                    <select class="block" ng-model="report.public_perms" ng-options="perm.id as perm.name for perm in form_input.permissions">
                    </select>
                </div>
              </div>
            </div>

            <div class="py1">
                <label >Report Name:</label>
                <input class="input block" size="80" maxlength="255" type="text" ng-model="report.name"/>
            </div>

            <div class="py1">
                <label >Description:</label>
                <input class="input block" size="80" maxlength="255" type="text" ng-model="report.description"/>
            </div>
        </div>

        <div class="py2 border-bottom">
            <h2>Recipients</h2>

            <div class="py1">
                <label >Team Members:</label>
                <table class="Table">
                  <tr ng-repeat="user in form_input.users">
                    <td><input type="checkbox" ng-model="user.incl" /></td>
                    <td class="full">{{user.name}}</td>
                  </tr>
                </table>
            </div>

            <div class="py1">
                <label >Email Aliases:</label>
                <input class="input block full" size="80" maxlength="255" type="text" ng-model="report.email_addresses"/>
            </div>
        </div>

        <div class="py2 border-bottom">
            <h2>Data</h2>

            <div class="py1">
              <label class="block">Database:</label>
              <div class="Select block">
                <select class="block" ng-model="report.dataset_query.database" ng-options="db.id as db.name for db in form_input.databases" ng-change="refreshTableList(report.dataset_query.database)">
                </select>
              </div>
            </div>

            <div class="py1">
              <label class="block">Table:</label>
              <div class="Select block">
                <select class="block" ng-model="report.dataset_query.query.source_table" ng-options="tbl.id as tbl.name for tbl in tables">
                </select>
              </div>
            </div>
        </div>

        <div class="py1">
            <h2>Schedule</h2>

            <div class="Button-group">
                <label class="Button" ng-class="{ 'Button--selected' : report.schedule.days_of_week[day.id] }" ng-model="report.schedule.days_of_week[day.id]" ng-repeat="day in form_input.days_of_week" btn-checkbox>{{day.name}}</label>
            </div>

            <div class="py1">
                <label class="Select">
                  <select ng-model="report.schedule.time_of_day" ng-options="tod.id as tod.name for tod in form_input.times_of_day">
                  </select>
                </label>

                <label class="Select">
                  <select ng-model="report.schedule.timezone" ng-options="tz for tz in form_input['timezones']">
                    <option value="">---  default timezone ---</option>
                  </select>
                </label>
            </div>

            <div class="py1">
              {{human_readable_schedule}}
            </div>
        </div>

        <div class="my1 py2 border-top">
          <div class="float-right">
            <input class="Button" type="button" value="Send Now" ng-if="report.id" ng-click="executeReport(report.id)"/>
          </div>

          <input class="Button Button--primary" type="button" value="Save" ng-click="save(report)"/>

          <div class="inline-block" ng-cloak>
              <span class="px2 text-success" ng-if="success_message" cv-delayed-call="clearStatus()">{{success_message}}</span>
              <span class="px2 text-error" ng-if="error_message" cv-delayed-call="clearStatus()">{{error_message}}</span>

              <alert class="alert" ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)" ng-animate=" 'animate' " cv-delayed-call="closeAlert($index)">{{alert.msg}}</alert>
          </div>
        </div>
    </form>
</section>
