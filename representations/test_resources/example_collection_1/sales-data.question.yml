display_name: Sales Data
type: question
version: v0
name: sales-data
description: Sales analysis with product categories and monthly averages
database: ref:database-1
query: |-
  SELECT
    "Products"."CATEGORY" AS "CATEGORY",
    CAST("PUBLIC"."ORDERS"."CREATED_AT" AS date) AS "CREATED_AT",
    AVG("PUBLIC"."ORDERS"."TOTAL") AS "avg",
    AVG("PUBLIC"."ORDERS"."QUANTITY") AS "avg_2",
    AVG("PUBLIC"."ORDERS"."TAX") AS "avg_3"
  FROM
    "PUBLIC"."ORDERS"

  LEFT JOIN (
      SELECT
        "PUBLIC"."PRODUCTS"."ID" AS "ID",
        "PUBLIC"."PRODUCTS"."EAN" AS "EAN",
        "PUBLIC"."PRODUCTS"."TITLE" AS "TITLE",
        "PUBLIC"."PRODUCTS"."CATEGORY" AS "CATEGORY",
        "PUBLIC"."PRODUCTS"."VENDOR" AS "VENDOR",
        "PUBLIC"."PRODUCTS"."PRICE" AS "PRICE",
        "PUBLIC"."PRODUCTS"."RATING" AS "RATING",
        "PUBLIC"."PRODUCTS"."CREATED_AT" AS "CREATED_AT"
      FROM
        "PUBLIC"."PRODUCTS"
    ) AS "Products" ON "PUBLIC"."ORDERS"."PRODUCT_ID" = "Products"."ID"
  GROUP BY
    "Products"."CATEGORY",
    CAST("PUBLIC"."ORDERS"."CREATED_AT" AS date)
  ORDER BY
    "Products"."CATEGORY" ASC,
    CAST("PUBLIC"."ORDERS"."CREATED_AT" AS date) ASC