{
    "name": "query-metric",
    "description": "Get the value of a curated and trustworthy business metric with optional filters or breakouts by dimension (e.g. over time or by a category). You can either choose the dimensions provided by the metric or the fields (also foreign key table fields) from the table the metric is based on. Filters can be applied without grouping and vice versa. If users ask for unspecific insights or interesting things, use the 'generate-insights' tool instead. Note that the query-metric tool already includes filtering, so you should not chain it with the 'filter-data' tool.",
    "parameters": {
        "type": "object",
        "properties": {
            "metric_id": {
                "type": "integer",
                "description": "The ID of the metric to calculate. Needs to exactly match the `metric_id` in the database and cannot be made up."
            },
            "filters": {
                "type": [
                    "array",
                    "null"
                ],
                "description": "Filter the records before calculating the metric. Each filter specifies a field, an operation, and a value (if required). For single filters, pass one object. If you want to filter on multiple columns, pass multiple objects. If the user doesn't specify any filters, set this parameter to null.",
                "items": {
                    "anyOf": [
                        {
                            "type": "object",
                            "properties": {
                                "operation": {
                                    "type": "string",
                                    "enum": [
                                        "is-null",
                                        "is-not-null",
                                        "string-is-empty",
                                        "string-is-not-empty",
                                        "is-true",
                                        "is-false"
                                    ],
                                    "description": "Operation to apply. `string-is-empty` and `string-is-not-empty` refer to both empty strings and NULL values."
                                },
                                "field_id": {
                                    "type": "string",
                                    "description": "ID of the field to filter. Needs to exactly match the `field_id` in the database. Provide numeric IDs as strings but never make up IDs."
                                }
                            },
                            "required": [
                                "field_id",
                                "operation"
                            ],
                            "additionalProperties": false
                        },
                        {
                            "type": "object",
                            "description": "Filter records on parts of a date or datetime field. Use this to include / exclude records based on the year, quarter, month, day-of-week, hour, minute, or second of a date or datetime field.",
                            "properties": {
                                "operation": {
                                    "type": "string",
                                    "enum": [
                                        "year-equals",
                                        "year-not-equals",
                                        "quarter-equals",
                                        "quarter-not-equals",
                                        "month-equals",
                                        "month-not-equals",
                                        "day-of-week-equals",
                                        "day-of-week-not-equals",
                                        "hour-equals",
                                        "hour-not-equals",
                                        "minute-equals",
                                        "minute-not-equals",
                                        "second-equals",
                                        "second-not-equals"
                                    ],
                                    "description": "Operation to apply"
                                },
                                "field_id": {
                                    "type": "string",
                                    "description": "ID of the date / datetime field to filter. Needs to exactly match the `field_id` in the database. Provide numeric IDs as strings but never make up IDs."
                                },
                                "value": {
                                    "type": "integer",
                                    "description": "Value to compare against. Needs to be integer: month (1-12), day-of-week (1-7 starting on Monday), hour (0-23), minute (0-59), second (0-59), quarter (1-4)."
                                }
                            },
                            "required": [
                                "operation",
                                "field_id",
                                "value"
                            ],
                            "additionalProperties": false
                        },
                        {
                            "type": "object",
                            "properties": {
                                "operation": {
                                    "type": "string",
                                    "enum": [
                                        "date-equals",
                                        "date-not-equals",
                                        "date-before",
                                        "date-on-or-before",
                                        "date-after",
                                        "date-on-or-after"
                                    ],
                                    "description": "Operation to apply"
                                },
                                "field_id": {
                                    "type": "string",
                                    "description": "ID of the date / datetime field to filter. Needs to exactly match the `field_id` in the database. Provide numeric IDs as strings but never make up IDs."
                                },
                                "value": {
                                    "type": "string",
                                    "description": "Value to compare against. Date needs to be in the format 'YYYY-MM-DD' and date-time in the format 'YYYY-MM-DDTHH:MM:SS' (without timezone). Datetime fields can also be compared against date values (this will return all records where the datetime field is on the same day as the date value)."
                                }
                            },
                            "required": [
                                "operation",
                                "field_id",
                                "value"
                            ],
                            "additionalProperties": false
                        },
                        {
                            "type": "object",
                            "properties": {
                                "operation": {
                                    "type": "string",
                                    "enum": [
                                        "string-equals",
                                        "string-not-equals",
                                        "string-contains",
                                        "string-not-contains",
                                        "string-starts-with",
                                        "string-ends-with"
                                    ],
                                    "description": "Operation to apply"
                                },
                                "field_id": {
                                    "type": "string",
                                    "description": "ID of the field to filter. Needs to exactly match the `field_id` in the database. Provide numeric IDs as strings but never make up IDs."
                                },
                                "value": {
                                    "type": "string",
                                    "description": "Value to compare against."
                                }
                            },
                            "required": [
                                "operation",
                                "field_id",
                                "value"
                            ],
                            "additionalProperties": false
                        },
                        {
                            "type": "object",
                            "properties": {
                                "operation": {
                                    "type": "string",
                                    "enum": [
                                        "number-equals",
                                        "number-not-equals",
                                        "number-greater-than",
                                        "number-greater-than-or-equal",
                                        "number-less-than",
                                        "number-less-than-or-equal"
                                    ],
                                    "description": "Operation to apply"
                                },
                                "field_id": {
                                    "type": "string",
                                    "description": "ID of the field to filter. Needs to exactly match the `field_id` in the database. Provide numeric IDs as strings but never make up IDs."
                                },
                                "value": {
                                    "type": [
                                        "number",
                                        "integer"
                                    ],
                                    "description": "Value to compare against."
                                }
                            },
                            "required": [
                                "operation",
                                "field_id",
                                "value"
                            ],
                            "additionalProperties": false
                        }
                    ]
                }
            },
            "group_by": {
                "type": [
                    "array",
                    "null"
                ],
                "description": "The dimensions to group by when calculating the metric. For a single dimension breakout, pass one object. If you want to group by multiple columns (e.g. one time dimension and one categorical), pass multiple objects. If the user doesn't specify a breakout explicitly, set this parameter to null to get the overall value. Do not add any groupings if the user only wants to filter the data or see the overall value. You can truncate date or datetime fields to a specific granularity (e.g. day, week, month, quarter, year) by setting the `field_granularity` to the desired value. If the field is not a date or datetime field, set `field_granularity` to null.",
                "items": {
                    "type": "object",
                    "properties": {
                        "field_id": {
                            "type": "string",
                            "description": "ID of the field to group by. Needs to exactly match the `field_id` in the database. Provide numeric IDs as strings but never make up IDs."
                        },
                        "field_granularity": {
                            "type": [
                                "string",
                                "null"
                            ],
                            "enum": [
                                null,
                                "day",
                                "week",
                                "month",
                                "quarter",
                                "year"
                            ],
                            "description": "The time granularity of the field to group by. Only applicable for date or datetime fields. If the field is not a date or datetime field, set this to null."
                        }
                    },
                    "required": [
                        "field_id",
                        "field_granularity"
                    ],
                    "additionalProperties": false
                }
            }
        },
        "required": [
            "metric_id",
            "filters",
            "group_by"
        ],
        "additionalProperties": false
    },
    "examples": [
        "User: Show me the number of new customers per country (metric id 255, country field id 9384\nAssistant: {\"tool_name\": \"query-metric\", \"arguments\": {\"metric_id\": 255, \"group_by\": [{\"field_id\": \"9384\", \"field_granularity\": null}], \"filters\": null}}",
        "User: How many orders did we have this year (metric id 255, date field id 9384, current year 2019)\nAssistant: {\"tool_name\": \"query-metric\", \"arguments\": {\"metric_id\": 255, \"filters\": [{\"field_id\": \"9384\", \"operation\": \"year-equals\", \"value\": 2019}], \"group_by\": null}}",
        "User: Show me the number of new customers per country and month (metric id 255, country field id 9384, month field id 9385)\nAssistant: {\"tool_name\": \"query-metric\", \"arguments\": {\"metric_id\": 255, \"group_by\": [{\"field_id\": \"9384\", \"field_granularity\": null}, {\"field_id\": \"9385\", \"field_granularity\": \"month\"}], \"filters\": null}}",
        "User: Daily revenue (metric id 255, date field id 9384)\nAssistant: {\"tool_name\": \"query-metric\", \"arguments\": {\"metric_id\": 255, \"group_by\": [{\"field_id\": \"9384\", \"field_granularity\": \"day\"}], \"filters\": null}}"
    ]
}
