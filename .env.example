# ==============================================================================
# 0. METABASE DEVELOPMENT ENVIRONMENT
# ==============================================================================
#
# Central configuration for local Metabase development.
# Copy to .env and uncomment/modify values as needed.
#
# Usage:
#   cp .env.example .env                                (populate manually)
#   op inject --in-file .env.example --out-file .env    (populate using CLI)
#
# Hint: Auto-load environment variables with direnv or mise:
#   direnv  - Create .envrc with: dotenv .env       (https://direnv.net)
#   mise    - mise.toml: [env] _.file = ".env"      (https://mise.jdx.dev)
#
# Full Metabase environment configuration reference:
# https://www.metabase.com/docs/latest/configuring-metabase/environment-variables


# ==============================================================================
# 1. E2E / CYPRESS TESTING
# ==============================================================================
#
# Configuration for running Cypress end-to-end tests locally.
#
# The whole environment is already orchestrated via deps.edn using :e2e alias.
# Treat it as a source of truth for JVM flags and ENVs whether you decide to run
# backend on your own, or using `yarn test-cypress` (local test runner).
#
# You don't _have to_ export any of these vars (except for the tokens below).
# Things will still work.

# 1.1. E2E Application Database (H2 required)
# ------------------------------------------------------------------------------

# Whether to run the enterprise or the open-source Metabase version
MB_EDITION="ee"

# Which file to use for the ephemeral testing application database?
MB_DB_FILE="./e2e/tmp/cypress-test.db"

# Where does Cypress go to look for the application?
MB_JETTY_PORT=4000

# 1.2 E2E Local Runner Setup
# ------------------------------------------------------------------------------

# Whether to run true e2e test suite, or SDK component tests (e2e | component)
CYPRESS_TESTING_TYPE="e2e"

# Whether to start Cypress in an interactive (open) mode with full GUI
CYPRESS_GUI="true"

# Whether to generate application database dumps (colloquially "snapshots")
# Unless you're experimenting, you generally want to leave this on.
GENERATE_SNAPSHOTS="true"

# By default we run a backend for E2E tests from source.
# If you populate the JAR_PATH variable, we'll start Metabase from it.
# E2E tests will run in that environment, just like they do in CI.
#
# Hint: build the JAR with ./bin/build.sh
# JAR_PATH="target/uberjar/metabase.jar"

# 1.3 E2E Tokens
# ------------------------------------------------------------------------------
#
# These make sense for Metabase core devs only
# op inject --in-file .env.example --out-file .env

CYPRESS_MB_ALL_FEATURES_TOKEN="op://Shared/Metabase License Dev Tokens/Licenses/MB_ALL_FEATURES_TOKEN"
CYPRESS_MB_STARTER_CLOUD_TOKEN="op://Shared/Metabase License Dev Tokens/Licenses/MB_STARTER_CLOUD_TOKEN"
CYPRESS_MB_PRO_CLOUD_TOKEN="op://Shared/Metabase License Dev Tokens/Licenses/MB_PRO_CLOUD_TOKEN"
CYPRESS_MB_PRO_SELF_HOSTED_TOKEN="op://Shared/Metabase License Dev Tokens/Licenses/MB_PRO_SELF_HOSTED_TOKEN"

# 1.4 E2E Misc.
# ------------------------------------------------------------------------------

# To make Node.js match the instance tz
TZ="US/Pacific"

# If you're running tests on Apple Silicon, DO NOT USE Docker Desktop.
# Use Orbstack, and make sure you have this env var exported. Metabase will fail
# to connect to the dockerized Mongo QA database without it.
EXPERIMENTAL_DOCKER_DESKTOP_FORCE_QEMU=1
