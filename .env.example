# ==============================================================================
# 0. METABASE DEVELOPMENT ENVIRONMENT
# ==============================================================================
#
# Central configuration for local Metabase development.
# Copy to .env and uncomment/modify values as needed.
#
# Usage:
#   op inject --in-file .env.example --out-file .env    (populate using CLI)
#   cp .env.example .env                                (populate manually)
#
# Hint: Auto-load environment variables with mise or direnv:
#   mise    - mise.toml: [settings] env_file = ".env"   (https://mise.jdx.dev)
#   direnv  - Create .envrc with: dotenv .env           (https://direnv.net)
#
# Full Metabase environment configuration reference:
# https://www.metabase.com/docs/latest/configuring-metabase/environment-variables


# ==============================================================================
# 1. E2E / CYPRESS TESTING
# ==============================================================================
#
# Configuration for running Cypress end-to-end tests locally.
#
# The whole environment is already orchestrated via deps.edn using :e2e alias.
# Treat it as a source of truth for JVM flags and ENVs whether you decide to run
# backend on your own, or using `yarn test-cypress` (local test runner).
#
# You don't _have to_ export any of these vars (except for the tokens below).
# Things will still work.

# 1.1. E2E Application Database (H2 required)
# ------------------------------------------------------------------------------

# Whether to run the enterprise or the open-source Metabase version
MB_EDITION="ee"

# Which file to use for the ephemeral testing application database?
MB_DB_FILE="./e2e/tmp/cypress-test.db"

# Where does Cypress go to look for the application?
MB_JETTY_PORT=4000

# 1.2 E2E Local Runner Setup
# ------------------------------------------------------------------------------

# Whether to run true e2e test suite, or SDK component tests (e2e | component)
CYPRESS_TESTING_TYPE="e2e"

# Whether to start Cypress in an interactive (open) mode with full GUI
CYPRESS_GUI="true"

# Whether to generate application database dumps (colloquially "snapshots")
# Keep this enabled unless you're experimenting, or know what you're doing.
GENERATE_SNAPSHOTS="true"

# E2E tests run the backend from source by default.
# To run tests against a JAR instead, set the JAR_PATH variable.
#
# Hint: build the JAR with ./bin/build.sh
# JAR_PATH="target/uberjar/metabase.jar"

# 1.3 E2E Tokens
# ------------------------------------------------------------------------------
#
# These make sense for Metabase core devs only
# op inject --in-file .env.example --out-file .env

CYPRESS_MB_ALL_FEATURES_TOKEN="op://Shared/Metabase License Dev Tokens/Licenses/MB_ALL_FEATURES_TOKEN"
CYPRESS_MB_STARTER_CLOUD_TOKEN="op://Shared/Metabase License Dev Tokens/Licenses/MB_STARTER_CLOUD_TOKEN"
CYPRESS_MB_PRO_CLOUD_TOKEN="op://Shared/Metabase License Dev Tokens/Licenses/MB_PRO_CLOUD_TOKEN"
CYPRESS_MB_PRO_SELF_HOSTED_TOKEN="op://Shared/Metabase License Dev Tokens/Licenses/MB_PRO_SELF_HOSTED_TOKEN"

# 1.4 E2E Misc.
# ------------------------------------------------------------------------------

# To make Node.js match the instance tz
TZ="US/Pacific"

# Export this environment variable when running tests on Apple Silicon.
# DO NOT USE Docker Desktop. Use Orbstack instead. Metabase will fail to connect
# to the dockerized Mongo QA database otherwise.
EXPERIMENTAL_DOCKER_DESKTOP_FORCE_QEMU=1
