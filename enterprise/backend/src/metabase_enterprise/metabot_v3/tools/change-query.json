{
  "name": "change-query",
  "description": "Changes the current `query` and executes it in Metabase. A query consists of changes. Use `query_columns` for the list of available columns.",
  "parameters": {
    "type": "object",
    "properties": {
      "changes": {
        "type": "array",
        "description": "List of changes to apply to the query.",
        "items": {
          "anyOf": [
            {
              "type": "object",
              "description": "Filter query results by a string column and value.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the add_string_filter change.",
                  "enum": [
                    "add_string_filter"
                  ]
                },
                "column_id": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "ID of the string column to apply filter for."
                },
                "operator": {
                  "type": "string",
                  "description": "String filter operator.",
                  "enum": [
                    "=",
                    "!=",
                    "contains",
                    "does-not-contain",
                    "starts-with",
                    "ends-with"
                  ]
                },
                "value": {
                  "type": "string",
                  "description": "String filter value."
                }
              },
              "required": [
                "type",
                "column_id",
                "operator",
                "value"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Filter query results by a numeric column and value.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the add_number_filter change.",
                  "enum": [
                    "add_number_filter"
                  ]
                },
                "column_id": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "ID of the numeric column to apply filter for."
                },
                "operator": {
                  "type": "string",
                  "description": "Numeric filter operator.",
                  "enum": [
                    "=",
                    "!=",
                    ">",
                    ">=",
                    "<",
                    "<="
                  ]
                },
                "value": {
                  "type": "number",
                  "description": "Numeric filter value."
                }
              },
              "required": [
                "type",
                "column_id",
                "operator",
                "value"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Filter query results by a boolean column and value.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the add_boolean_filter change.",
                  "enum": [
                    "add_boolean_filter"
                  ]
                },
                "column_id": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "ID of the boolean column to apply filter for."
                },
                "operator": {
                  "type": "string",
                  "description": "Boolean filter operator.",
                  "enum": [
                    "="
                  ]
                },
                "value": {
                  "type": "boolean",
                  "description": "Boolean filter value."
                }
              },
              "required": [
                "type",
                "column_id",
                "operator",
                "value"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Filter query results by a date column and value. The date value must be a specific date.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the add_specific_date_filter change.",
                  "enum": [
                    "add_specific_date_filter"
                  ]
                },
                "column_id": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "ID of the date column to apply filter for."
                },
                "operator": {
                  "type": "string",
                  "description": "Date filter operator.",
                  "enum": [
                    "=",
                    ">",
                    "<"
                  ]
                },
                "value": {
                  "type": "string",
                  "description": "Date filter value. Must be a date in ISO 8601 format."
                }
              },
              "required": [
                "type",
                "column_id",
                "operator",
                "value"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Filter query results by a date column and value. Unlike specific-date-filter, the filter range here is a relative to current time. Examples: '1 year ago', 'this week', 'next 3 days'.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the add_relative_date_filter change.",
                  "enum": [
                    "add_relative_date_filter"
                  ]
                },
                "column_id": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "ID of the date column to apply filter for."
                },
                "direction": {
                  "type": "string",
                  "description": "Direction of the date interval. Possible values are last, current, next. Last means intervals in the past, like last 30 days. Current means intervals including this moment, like this week. Next means intervals in the future, like next 2 months.",
                  "enum": [
                    "last",
                    "current",
                    "next"
                  ]
                },
                "value": {
                  "type": "number",
                  "description": "How long the date range is, in units of time. Example: for 'last 5 weeks' the value is 5, for 'next 3 years' the value is 3. For current intervals there is no value and it should be set to zero."
                },
                "unit": {
                  "type": "string",
                  "description": "Unit of time used for the date interval.",
                  "enum": [
                    "day",
                    "week",
                    "month",
                    "quarter",
                    "year"
                  ]
                }
              },
              "required": [
                "type",
                "column_id",
                "direction",
                "value",
                "unit"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Removes a filter.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of remove_filter change.",
                  "enum": [
                    "remove_filter"
                  ]
                },
                "filter_position": {
                  "type": "number",
                  "description": "Index of the filter clause to remove. `query.filters` is the list of the current query filters."
                }
              },
              "required": [
                "type",
                "filter_position"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Aggregate query results.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the add_aggregation change.",
                  "enum": [
                    "add_aggregation"
                  ]
                },
                "operator": {
                  "type": "string",
                  "description": "Aggregation operator.",
                  "enum": [
                    "count",
                    "sum",
                    "avg",
                    "distinct",
                    "cum-sum",
                    "cum-count",
                    "stddev",
                    "min",
                    "max"
                  ]
                },
                "column_id": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "ID of an optional column for the selected aggregation operator. If not specified, set it to null."
                }
              },
              "required": [
                "type",
                "operator",
                "column_id"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Removes an aggregation.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of remove_aggregation change.",
                  "enum": [
                    "remove_aggregation"
                  ]
                },
                "aggregation_position": {
                  "type": "number",
                  "description": "Index of the aggregation clause to remove. `query.aggregations` is the list of the current query aggregations."
                }
              },
              "required": [
                "type",
                "aggregation_position"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Group by, or breakout, query results.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the add_breakout change.",
                  "enum": [
                    "add_breakout"
                  ]
                },
                "column_id": {
                  "type": "string",
                  "description": "ID of the column to apply grouping for."
                }
              },
              "required": [
                "type",
                "column_id"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Removes a grouping, or a breakout.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of remove_breakout change.",
                  "enum": [
                    "remove_breakout"
                  ]
                },
                "breakout_position": {
                  "type": "number",
                  "description": "Index of the breakout clause to remove. `query.breakouts` is the list of the current query breakouts."
                }
              },
              "required": [
                "type",
                "breakout_position"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Sort the query results.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the add_order_by by change.",
                  "enum": [
                    "add_order_by"
                  ]
                },
                "column_id": {
                  "type": "string",
                  "description": "ID of the column to apply sorting for."
                },
                "direction": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "enum": [
                    "asc",
                    "desc"
                  ],
                  "description": "Optional sorting direction, either ascending or descending."
                }
              },
              "required": [
                "type",
                "column_id",
                "direction"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Removes a sorting clause.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of remove_order_by change.",
                  "enum": [
                    "remove_order_by"
                  ]
                },
                "order_by_position": {
                  "type": "number",
                  "description": "Index of the order_by clause to remove. `query.order_bys` is the list of the current query sorting clauses."
                }
              },
              "required": [
                "type",
                "order_by_position"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Set the row limit for the query.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of the add_limit change.",
                  "enum": [
                    "add_limit"
                  ]
                },
                "limit": {
                  "type": "number",
                  "description": "Row limit."
                }
              },
              "required": [
                "type",
                "limit"
              ],
              "additionalProperties": false
            },
            {
              "type": "object",
              "description": "Removes a row limit from the query.",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Type of remove_limit change.",
                  "enum": [
                    "remove_limit"
                  ]
                }
              },
              "required": [
                "type"
              ],
              "additionalProperties": false
            }
          ]
        }
      }
    },
    "required": [
      "changes"
    ],
    "additionalProperties": false
  }
}
